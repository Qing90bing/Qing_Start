<!DOCTYPE html>
<html lang="zh-CN" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>起始页</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles for the page */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease-in-out;
        }
        .text-shadow-custom {
             text-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .dark .text-shadow-custom {
             text-shadow: 0 2px 12px rgba(0,0,0,0.6);
        }
        
        /* Set numbers to monospaced (tabular) */
        #time-date-container {
            font-variant-numeric: tabular-nums;
        }

        /* Background container with blur effect */
        #background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: opacity 0.8s ease-in-out;
            z-index: -2;
            opacity: 0;
            filter: blur(10px);
            transform: scale(1.1);
        }
        #background-container.loaded {
            opacity: 1;
        }
        
        /* Background overlay for text contrast */
        #background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.15);
            z-index: -1;
            transition: background-color 0.3s ease-in-out;
        }

        /* Pseudo-element for cross-fade transition */
        #background-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        #background-container.is-fading::before {
            opacity: 1;
        }

        /* Glassmorphism effect for interactive elements */
        .glass-effect {
            background-color: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }

        .dark .glass-effect {
            background-color: rgba(30, 30, 30, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Override for search engine list in day mode to ensure contrast */
        #search-engine-list-wrapper.glass-effect {
            background-color: rgba(80, 80, 80, 0.6);
            border-color: rgba(255, 255, 255, 0.1);
        }

        /* Custom scrollbar for dropdown lists */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 2px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Hide search input's default clear button */
        #search-input::-webkit-search-decoration,
        #search-input::-webkit-search-cancel-button,
        #search-input::-webkit-search-results-button,
        #search-input::-webkit-search-results-decoration {
            -webkit-appearance:none;
        }
        
        /* Search input text and placeholder styling */
        #search-input {
            transition: color 0.3s ease-in-out;
            text-shadow: 0 1px 4px rgba(0,0,0,0.4);
        }
        #search-input::placeholder {
            color: rgb(75 85 99);
            transition: color 0.3s ease-in-out;
        }
        .dark #search-input::placeholder {
            color: rgb(209 213 219 / 0.7);
        }

        /* Spinning animation for refresh button */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(-360deg); }
        }
        .is-spinning {
            animation: spin 1s linear infinite;
        }

        /* Style for the active theme item in the menu */
        .theme-item-active {
            background-color: rgba(0, 0, 0, 0.08);
        }
        .dark .theme-item-active {
            background-color: rgba(255, 255, 255, 0.15);
        }

        /* Unified icon color for day/night modes */
        .icon-color {
            color: rgb(255 255 255); /* white */
            transition: color 0.3s ease-in-out;
        }
        .dark .icon-color {
            color: rgb(255 255 255); /* white */
        }

        /* Unified search engine icon sizing */
        .search-engine-icon svg {
            width: 100%;
            height: 100%;
            object-fit: contain;
            fill: currentColor; /* Ensures SVG color is inherited */
        }
        
        /* Styles for icon transition */
        .search-engine-icon-container {
            position: absolute;
            width: 28px; /* w-7 */
            height: 28px; /* h-7 */
            transition: opacity 0.2s ease-in-out;
        }

        /* Hitokoto styles */
        #hitokoto-container {
            margin-top: 1rem; /* mt-4 */
            /* MODIFIED: Add auto margins for horizontal centering */
            margin-left: auto;
            margin-right: auto;
            padding: 0.5rem 1rem; /* p-2 px-4 */
            max-width: 80%;
            font-weight: 500; /* font-medium */
            cursor: pointer;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        #hitokoto-container.is-fading {
            opacity: 0;
            transform: translateY(-10px);
        }

        /* Preloader Styles */
        #preloader {
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
        }

        #preloader.preloader-hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        #preloader-icon {
            animation: breathing 1.5s ease-in-out infinite;
        }

        @keyframes breathing {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.2;
            }
        }

        /* Main Content Visibility */
        #main-content {
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        #main-content.visible {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-200 dark:bg-black">

    <div id="preloader" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <img src="favicon.svg" alt="Loading..." id="preloader-icon" class="w-16 h-16">
    </div>

    <div id="background-container"></div>
    <div id="background-overlay"></div>
    <div id="pseudo-style-container"></div>

    <div id="main-content" class="relative min-h-screen w-full flex flex-col items-center justify-center p-4 text-white">

        <div id="refresh-button" class="absolute top-5 left-5 p-2 rounded-full cursor-pointer hover:bg-black/10 dark:hover:bg-white/20 transition-colors" title="刷新背景">
            <svg class="refresh-icon icon-color" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M21 21v-5h-5"/></svg>
        </div>

        <div class="absolute top-5 right-5">
             <div class="relative">
                <button id="theme-button" class="p-2 rounded-full cursor-pointer hover:bg-black/10 dark:hover:bg-white/20 transition-colors">
                    </button>
                <div id="theme-menu" class="absolute top-full right-0 mt-2 w-36 rounded-xl shadow-lg glass-effect origin-top-right transition-all duration-300 scale-y-0 opacity-0 p-1">
                    </div>
            </div>
        </div>

        <div id="time-date-container" class="text-center absolute top-8 md:top-16 text-shadow-custom">
            <div id="time" class="text-7xl md:text-8xl font-semibold tracking-tighter">00:00</div>
            <div id="date" class="text-lg md:text-xl font-medium mt-1"></div>
            <div id="hitokoto-container" class="text-lg md:text-xl" title="点击切换"></div>
        </div>

        <div class="w-full max-w-xl relative">
            <form id="search-form" class="flex items-center w-full h-14 rounded-full shadow-lg glass-effect">
                <div id="search-engine-logo" class="relative flex-shrink-0 w-14 h-14 flex items-center justify-center cursor-pointer rounded-l-full hover:bg-black/10 dark:hover:bg-white/20 transition-colors icon-color">
                    <div id="icon-container-a" class="search-engine-icon-container"></div>
                    <div id="icon-container-b" class="search-engine-icon-container"></div>
                </div>
                
                <input type="search" id="search-input" class="w-full h-full bg-transparent text-lg text-white focus:outline-none px-4" placeholder="搜索..." autocomplete="off">
                
                <button type="submit" class="flex-shrink-0 w-14 h-14 flex items-center justify-center rounded-r-full hover:bg-black/10 dark:hover:bg-white/20 transition-colors" title="搜索">
                    <svg class="icon-color" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </button>
            </form>

            <div id="search-engine-list-wrapper" class="absolute top-full mt-2 w-full rounded-2xl shadow-lg glass-effect origin-top transition-all duration-300 scale-y-0 opacity-0 p-1.5">
                <div id="search-engine-list" class="max-h-60 overflow-y-auto custom-scrollbar">
                    </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element References ---
            const preloader = document.getElementById('preloader');
            const mainContent = document.getElementById('main-content');
            const backgroundContainer = document.getElementById('background-container');
            const pseudoStyleContainer = document.getElementById('pseudo-style-container');
            const refreshButton = document.getElementById('refresh-button');
            const refreshIcon = document.querySelector('#refresh-button .refresh-icon');
            const themeButton = document.getElementById('theme-button');
            const themeMenu = document.getElementById('theme-menu');
            const timeEl = document.getElementById('time');
            const dateEl = document.getElementById('date');
            const searchForm = document.getElementById('search-form');
            const searchInput = document.getElementById('search-input');
            const searchEngineLogo = document.getElementById('search-engine-logo');
            const searchEngineListWrapper = document.getElementById('search-engine-list-wrapper');
            const searchEngineList = document.getElementById('search-engine-list');
            const htmlEl = document.documentElement;
            const iconContainerA = document.getElementById('icon-container-a');
            const iconContainerB = document.getElementById('icon-container-b');
            const hitokotoContainer = document.getElementById('hitokoto-container');

            // --- State Variables ---
            let currentEngine = '';
            let activeIconContainerId = 'a';
            let isInitialLogoLoad = true;
            let isFetchingHitokoto = false;

            // --- Search Engine Configuration ---
            const engineOrder = ['baidu', 'google', 'bing', 'sogou', 'github', 'zhihu', 'yandex', 'bilibili', 'duckduckgo', '360'];
            const searchEngines = {
                google: { name: 'Google', url: 'https://www.google.com/search?q=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032 s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2 C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"></path></svg>` },
                baidu: { name: '百度', url: 'https://www.baidu.com/s?wd=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M6.217 12.486c1.964-.422 1.693-2.772 1.637-3.287-.096-.788-1.028-2.172-2.291-2.061-1.588.141-1.821 2.44-1.821 2.44-.216 1.06.515 3.33 2.475 2.908m3.646-3.944c1.084 0 1.959-1.251 1.959-2.792 0-1.537-.871-2.785-1.955-2.785-1.086 0-1.966 1.242-1.966 2.785s.88 2.792 1.965 2.792m4.671.186c1.454.195 2.38-1.355 2.568-2.53.188-1.166-.754-2.528-1.776-2.763-1.031-.237-2.303 1.411-2.431 2.484-.136 1.318.188 2.627 1.634 2.813m5.751 1.973c0-.562-.46-2.253-2.19-2.253-1.729 0-1.965 1.596-1.965 2.726 0 1.077.089 2.573 2.247 2.528 2.148-.052 1.913-2.438 1.913-3.002M18.1 15.626s-2.247-1.739-3.557-3.613c-1.776-2.768-4.304-1.64-5.144-.239-.845 1.418-2.153 2.306-2.339 2.544-.188.232-2.709 1.596-2.147 4.079.563 2.483 2.528 2.439 2.528 2.439s1.446.142 3.133-.234c1.686-.375 3.13.091 3.13.091s3.92 1.317 5.005-1.212c1.072-2.537-.61-3.847-.61-3.847"></path></svg>` },
                bing: { name: 'Bing', url: 'https://www.bing.com/search?q=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 4 2 C 5.527344 2.464844 7.054688 2.933594 8.582031 3.402344 C 8.578125 7.171875 8.585938 10.941406 8.578125 14.710938 C 7.09375 16.023438 5.621094 17.347656 4.140625 18.664063 C 7.757813 16.765625 11.371094 14.859375 14.984375 12.957031 C 13.984375 12.5 12.976563 12.050781 11.976563 11.59375 C 11.300781 10.121094 10.617188 8.652344 9.941406 7.183594 C 13.296875 8.207031 16.648438 9.234375 20.003906 10.261719 C 20.003906 11.902344 20.003906 13.539063 20.003906 15.179688 C 16.1875 17.453125 12.371094 19.726563 8.554688 22 C 7.035156 20.9375 5.519531 19.871094 4 18.808594 C 4 13.207031 4 7.601563 4 2 Z"></path></svg>` },
                duckduckgo: { name: 'DuckDuckGo', url: 'https://duckduckgo.com/?q=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 12 C 2 9.109375 2.945313 6.722656 4.832031 4.832031 C 6.722656 2.945313 9.109375 2 12 2 C 14.890625 2 17.277344 2.945313 19.167969 4.832031 C 21.054688 6.722656 22 9.109375 22 12 C 22 14.445313 21.308594 16.550781 19.921875 18.308594 C 18.539063 20.070313 16.65625 21.21875 14.277344 21.757813 C 14.15625 21.53125 13.933594 21.179688 13.601563 20.710938 C 13.273438 20.238281 13.042969 19.863281 12.90625 19.582031 C 13.765625 19.929688 14.34375 20.105469 14.640625 20.105469 C 14.855469 20.105469 14.964844 19.769531 14.964844 19.097656 C 14.964844 17.847656 14.851563 17.222656 14.621094 17.222656 C 14.285156 17.222656 13.632813 17.59375 12.664063 18.332031 C 12.664063 18.144531 12.5625 18.0625 12.363281 18.089844 L 12.261719 18.089844 C 11.914063 17.160156 11.738281 16.335938 11.738281 15.609375 C 11.738281 15.40625 11.757813 15.207031 11.796875 15.003906 C 13.035156 15.609375 14.027344 15.910156 14.78125 15.910156 C 15.199219 15.910156 15.828125 15.789063 16.667969 15.546875 C 17.507813 15.304688 17.925781 15.042969 17.925781 14.761719 C 17.925781 14.585938 17.8125 14.5 17.585938 14.5 C 17.234375 14.5 16.730469 14.546875 16.070313 14.640625 C 15.414063 14.734375 14.910156 14.78125 14.558594 14.78125 C 14.195313 14.78125 13.796875 14.6875 13.359375 14.5 C 12.921875 14.3125 12.703125 14.054688 12.703125 13.734375 C 12.703125 13.667969 12.714844 13.617188 12.734375 13.582031 C 12.753906 13.550781 12.785156 13.527344 12.824219 13.523438 C 12.867188 13.515625 12.90625 13.515625 12.945313 13.523438 C 12.988281 13.53125 13.039063 13.535156 13.109375 13.542969 C 13.175781 13.550781 13.234375 13.554688 13.289063 13.554688 C 13.410156 13.554688 13.585938 13.570313 13.8125 13.601563 C 14.039063 13.636719 14.210938 13.652344 14.316406 13.652344 C 14.734375 13.652344 15.585938 13.40625 16.878906 12.917969 C 18.167969 12.425781 18.8125 12.046875 18.8125 11.777344 C 18.8125 11.617188 18.6875 11.503906 18.4375 11.433594 C 18.191406 11.367188 17.957031 11.335938 17.742188 11.335938 C 17.554688 11.335938 17.273438 11.382813 16.894531 11.484375 C 16.519531 11.585938 16.109375 11.707031 15.664063 11.847656 C 15.222656 11.988281 14.925781 12.078125 14.777344 12.121094 C 14.832031 11.851563 14.859375 11.636719 14.859375 11.476563 C 14.859375 10.84375 14.691406 10.105469 14.355469 9.265625 C 14.019531 8.425781 13.628906 7.804688 13.1875 7.402344 C 12.824219 7.078125 12.339844 6.859375 11.734375 6.738281 C 11.359375 6.253906 10.769531 5.8125 9.972656 5.414063 C 9.171875 5.019531 8.460938 4.820313 7.84375 4.820313 C 7.722656 4.820313 7.539063 4.84375 7.289063 4.890625 C 7.042969 4.9375 6.886719 4.96875 6.820313 4.984375 L 6.375 5.609375 L 6.496094 5.628906 C 6.589844 5.628906 6.734375 5.617188 6.929688 5.589844 C 7.125 5.5625 7.269531 5.550781 7.363281 5.550781 C 7.820313 5.550781 8.34375 5.644531 8.933594 5.832031 C 8.558594 6.019531 8.230469 6.148438 7.949219 6.214844 C 7.921875 6.226563 7.835938 6.242188 7.6875 6.265625 C 7.539063 6.285156 7.414063 6.304688 7.3125 6.324219 C 7.210938 6.34375 7.117188 6.382813 7.03125 6.445313 C 6.945313 6.503906 6.898438 6.582031 6.898438 6.675781 C 7.652344 6.597656 8.21875 6.554688 8.59375 6.554688 C 9.105469 6.554688 9.507813 6.601563 9.804688 6.695313 C 8.765625 6.820313 7.972656 7.175781 7.414063 7.765625 C 6.855469 8.355469 6.574219 9.171875 6.574219 10.207031 C 6.574219 10.570313 6.601563 10.90625 6.65625 11.214844 C 6.910156 12.828125 7.402344 15.234375 8.128906 18.433594 C 8.574219 20.503906 8.820313 21.644531 8.875 21.859375 L 8.894531 21.941406 C 6.742188 21.269531 5.058594 20.019531 3.835938 18.199219 C 2.613281 16.378906 2 14.3125 2 12 Z M 7.707031 9.5 C 7.707031 9.582031 7.726563 9.660156 7.765625 9.742188 C 7.753906 9.527344 7.875 9.339844 8.128906 9.175781 C 8.382813 9.015625 8.625 8.933594 8.855469 8.933594 C 8.964844 8.933594 9.097656 8.96875 9.257813 9.035156 C 9.125 8.863281 8.929688 8.773438 8.671875 8.773438 C 8.445313 8.773438 8.226563 8.839844 8.019531 8.964844 C 7.808594 9.09375 7.707031 9.273438 7.707031 9.5 Z M 8.371094 11.011719 C 8.371094 10.835938 8.441406 10.679688 8.582031 10.539063 C 8.722656 10.398438 8.882813 10.324219 9.058594 10.324219 C 9.230469 10.324219 9.390625 10.398438 9.53125 10.539063 C 9.671875 10.679688 9.742188 10.835938 9.742188 11.011719 C 9.742188 11.1875 9.671875 11.34375 9.53125 11.484375 C 9.390625 11.628906 9.230469 11.699219 9.058594 11.699219 C 8.882813 11.699219 8.722656 11.628906 8.582031 11.484375 C 8.441406 11.34375 8.371094 11.1875 8.371094 11.011719 Z M 9.175781 10.789063 C 9.175781 10.898438 9.238281 10.949219 9.359375 10.949219 C 9.480469 10.949219 9.539063 10.898438 9.539063 10.789063 C 9.539063 10.667969 9.480469 10.609375 9.359375 10.609375 C 9.238281 10.609375 9.175781 10.667969 9.175781 10.789063 Z M 12.566406 9.035156 C 12.671875 8.859375 12.921875 8.773438 13.3125 8.773438 C 13.484375 8.773438 13.707031 8.839844 13.976563 8.976563 C 13.84375 8.679688 13.605469 8.53125 13.269531 8.53125 C 12.851563 8.53125 12.617188 8.699219 12.566406 9.035156 Z M 13.027344 10.609375 C 13.027344 10.449219 13.089844 10.308594 13.210938 10.195313 C 13.328125 10.082031 13.464844 10.023438 13.613281 10.023438 C 13.773438 10.023438 13.910156 10.082031 14.023438 10.195313 C 14.140625 10.308594 14.195313 10.449219 14.195313 10.609375 C 14.195313 10.757813 14.140625 10.890625 14.023438 11.011719 C 13.910156 11.132813 13.773438 11.191406 13.613281 11.191406 C 13.464844 11.191406 13.328125 11.132813 13.210938 11.011719 C 13.089844 10.890625 13.027344 10.757813 13.027344 10.609375 Z M 13.734375 10.40625 C 13.734375 10.515625 13.78125 10.566406 13.875 10.566406 C 13.984375 10.566406 14.035156 10.515625 14.035156 10.40625 C 14.035156 10.3125 13.980469 10.265625 13.875 10.265625 C 13.78125 10.265625 13.734375 10.3125 13.734375 10.40625 Z"></path></svg>` },
                sogou: { name: '搜狗', url: 'https://www.sogou.com/web?query=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.305 16.17c-2.925.555-5.805-.721-8.325-2.1-.03 1.02-.06 2.01-.06 3 3.195 1.409 6.75 2.069 10.2 1.529 1.17-.225 2.37-.6 3.225-1.454 1.229-1.2 1.111-3.511-.33-4.5H18v.001c-2.25-1.86-5.34-2.101-7.801-3.556-.75-.479-.148-1.395.602-1.425 2.699-.45 5.369.63 7.889 1.5l.151-2.655c-3.151-1.14-6.57-1.875-9.901-1.35-1.2.3-2.4.675-3.254 1.56-1.171 1.2-.961 3.36.389 4.32 2.236 1.755 5.176 2.011 7.621 3.36.96.39.555 1.68-.391 1.77zm8.536 4.979-.946-1.318a10.312 10.312 0 0 1-4.08 2.909h-.014L17.79 24c1.561-.676 2.926-1.62 4.051-2.851z"></path><path d="M20.894 19.831C22.801 17.729 24 14.939 24 11.88 24 5.295 18.63 0 12 0S0 5.311 0 11.85c0 6.57 5.37 11.88 12 11.88 1.71 0 3.33-.346 4.801-.99l-.961-1.26c-1.2.45-2.49.719-3.84.719-5.775 0-10.455-4.619-10.455-10.35C1.545 6.15 6.225 1.53 12 1.53s10.456 4.65 10.456 10.35c0 2.55-.946 4.891-2.507 6.69l.945 1.261z"></path><path d="m8.739 14.074.011-.001.007-.003z"></path></svg>` },
                '360': { name: '360搜索', url: 'https://www.so.com/s?q=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1126 1024"><path d="M895.59 864.222c0-49.664 40.653-90.215 90.215-90.215 49.664 0 90.214 40.55 90.214 90.112a90.522 90.522 0 0 1-90.112 90.317 90.522 90.522 0 0 1-90.317-90.214zM897.024 679.185l-130.765-52.634c-10.547-4.505-10.547-11.98-5.939-22.528 11.98-31.539 18.022-66.15 18.022-100.761 0-147.354-124.928-273.613-273.715-273.613-148.89 0-273.613 126.26-273.613 273.613 0 34.611 9.012 70.656 20.992 102.297 3.072 6.042 3.072 13.517 0 19.456-3.072 4.608-6.041 0-10.547 1.536l-133.734 43.623c-1.536 1.536-4.608 1.536-6.144 1.536-8.909 0-14.95-4.506-17.92-13.517-19.559-51.2-30.106-102.298-30.106-154.931A452.403 452.403 0 0 1 504.627 52.19c248.115 0 451.072 201.523 451.072 449.536 0 58.675-10.445 114.38-31.539 166.912a17.203 17.203 0 0 1-11.98 10.547c-3.073 1.536-4.506 1.536-7.578 1.536s-4.506 0-7.476-1.536z"></path><path d="M103.117 710.827c-7.475-15.053-13.517-31.642-19.456-46.592-3.072-7.578-3.072-13.62-3.072-16.59 0-49.663 40.653-88.678 91.75-88.678 37.581 0 69.12 22.528 84.173 55.604 1.536 3.072 6.042 11.98 9.011 16.588a271.053 271.053 0 0 0 239.104 145.818c99.328 0 189.44-55.603 237.568-141.312 4.506-9.114 16.589-30.106 18.125-31.642 14.95-30.003 43.52-45.056 76.595-45.056 51.2 0 91.75 40.55 91.75 88.679 0 6.041 0 13.517-4.505 22.528l-9.011 22.528v1.536a45.056 45.056 0 0 1-6.042 12.083 448.512 448.512 0 0 1-404.48 248.115c-169.984 0-323.277-93.184-401.408-243.712z"></path></svg>` },
                yandex: { name: 'Yandex', url: 'https://yandex.com/search/?text=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="m20.8 1-5.6 16.2-5-13.2H7l7 18.6V31h3v-9.9L24 1h-3.2z"></path></svg>` },
                bilibili: { name: 'Bilibili', url: 'https://search.bilibili.com/all?keyword=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M18.223 3.086a1.25 1.25 0 0 1 0 1.768L17.08 5.996h1.17A3.75 3.75 0 0 1 22 9.747v7.5a3.75 3.75 0 0 1-3.75 3.75H5.75A3.75 3.75 0 0 1 2 17.247v-7.5a3.75 3.75 0 0 1 3.75-3.75h1.166L5.775 4.855a1.25 1.25 0 0 1 1.767-1.768l2.652 2.652q.119.119.198.257h3.213q.08-.14.199-.258l2.651-2.652a1.25 1.25 0 0 1 1.768 0m.027 5.42H5.75a1.25 1.25 0 0 0-1.247 1.157l-.003.094v7.5c0 .659.51 1.198 1.157 1.246l.093.004h12.5a1.25 1.25 0 0 0 1.247-1.157l.003-.093v-7.5c0-.69-.56-1.25-1.25-1.25m-10 2.5c.69 0 1.25.56 1.25 1.25v1.25a1.25 1.25 0 1 1-2.5 0v-1.25c0-.69.56-1.25 1.25-1.25m7.5 0c.69 0 1.25.56 1.25 1.25v1.25a1.25 1.25 0 1 1-2.5 0v-1.25c0-.69.56-1.25 1.25-1.25"></path></svg>` },
                github: { name: 'GitHub', url: 'https://github.com/search?q=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M5.315 2.1c.791-.113 1.9.145 3.333.966l.272.161.16.1.397-.083a13.3 13.3 0 0 1 4.59-.08l.456.08.396.083.161-.1c1.385-.84 2.487-1.17 3.322-1.148l.164.008.147.017.076.014.05.011.144.047a1 1 0 0 1 .53.514 5.2 5.2 0 0 1 .397 2.91l-.047.267-.046.196.123.163c.574.795.93 1.728 1.03 2.707l.023.295L21 9.5c0 3.855-1.659 5.883-4.644 6.68l-.245.061-.132.029.014.161.008.157.004.365-.002.213L16 21a1 1 0 0 1-.883.993L15 22H9a1 1 0 0 1-.993-.883L8 21v-.734c-1.818.26-3.03-.424-4.11-1.878l-.535-.766c-.28-.396-.455-.579-.589-.644l-.048-.019a1 1 0 0 1 .564-1.918c.642.188 1.074.568 1.57 1.239l.538.769c.76 1.079 1.36 1.459 2.609 1.191L8 17.562l-.018-.168a5 5 0 0 1-.021-.824l.017-.185.019-.12-.108-.024c-2.976-.71-4.703-2.573-4.875-6.139l-.01-.31L3 9.5a5.6 5.6 0 0 1 .908-3.051l.152-.222.122-.163-.045-.196a5.2 5.2 0 0 1 .145-2.642l.1-.282.106-.253a1 1 0 0 1 .529-.514l.144-.047z"></path></svg>` },
                zhihu: { name: '知乎', url: 'https://www.zhihu.com/search?type=content&q=', logo: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64m-90.7 477.8-.1 1.5c-1.5 20.4-6.3 43.9-12.9 67.6l24-18.1 71 80.7c9.2 33-3.3 63.1-3.3 63.1l-95.7-111.9v-.1c-8.9 29-20.1 57.3-33.3 84.7-22.6 45.7-55.2 54.7-89.5 57.7-34.4 3-23.3-5.3-23.3-5.3 68-55.5 78-87.8 96.8-123.1 11.9-22.3 20.4-64.3 25.3-96.8H264.1s4.8-31.2 19.2-41.7h101.6c.6-15.3-1.3-102.8-2-131.4h-49.4c-9.2 45-41 56.7-48.1 60.1-7 3.4-23.6 7.1-21.1 0 2.6-7.1 27-46.2 43.2-110.7 16.3-64.6 63.9-62 63.9-62-12.8 22.5-22.4 73.6-22.4 73.6h159.7c10.1 0 10.6 39 10.6 39h-90.8c-.7 22.7-2.8 83.8-5 131.4H519s12.2 15.4 12.2 41.7zm346.5 167h-87.6l-69.5 46.6-16.4-46.6h-40.1V321.5h213.6zM408.2 611s0-.1 0 0m216 94.3 56.8-38.1h45.6-.1V364.7H596.7v302.5h14.1z"></path></svg>` },
            };

            // --- Theme Management ---
            const themeConfig = {
                auto: { name: '跟随系统', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>` },
                light: { name: '日间模式', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>` },
                dark: { name: '夜间模式', icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>` },
            };

            function applyTheme(theme) {
                if (theme === 'auto') {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    htmlEl.classList.toggle('dark', prefersDark);
                } else {
                    htmlEl.classList.toggle('dark', theme === 'dark');
                }
                localStorage.setItem('theme', theme);
                themeButton.innerHTML = `<div class="icon-color">${themeConfig[theme].icon}</div>`;

                document.querySelectorAll('.theme-menu-item').forEach(el => {
                    el.classList.toggle('theme-item-active', el.dataset.theme === theme);
                });
            }

            function toggleThemeMenu(show) {
                if (show) {
                    themeMenu.classList.remove('scale-y-0', 'opacity-0');
                } else {
                    themeMenu.classList.add('scale-y-0', 'opacity-0');
                }
            }

            function populateThemeMenu() {
                themeMenu.innerHTML = '';
                Object.keys(themeConfig).forEach(key => {
                    const item = document.createElement('div');
                    item.className = 'theme-menu-item flex items-center p-2 cursor-pointer hover:bg-black/10 dark:hover:bg-white/20 transition-colors rounded-lg';
                    item.dataset.theme = key;
                    item.innerHTML = `
                        <span class="w-6 h-6 icon-color">${themeConfig[key].icon}</span>
                        <span class="ml-3 text-sm font-medium">${themeConfig[key].name}</span>
                    `;
                    item.addEventListener('click', () => {
                        applyTheme(key);
                        toggleThemeMenu(false);
                    });
                    themeMenu.appendChild(item);
                });
            }

            themeButton.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = themeMenu.classList.contains('scale-y-0');
                toggleThemeMenu(isHidden);
            });

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (localStorage.getItem('theme') === 'auto') {
                    htmlEl.classList.toggle('dark', e.matches);
                }
            });

            
            // --- Background Image ---
            let isRefreshing = false;

            // Function to hide preloader and show main content
            function completeLoading() {
                if (preloader.classList.contains('preloader-hidden')) return;
                
                preloader.classList.add('preloader-hidden');
                mainContent.classList.add('visible');
            }
            
            function getBackgroundCategory() {
                const hour = new Date().getHours();
                if (hour >= 6 && hour < 18) {
                    const categories = ['nature', 'landscape', 'architecture', 'minimal'];
                    return categories[Math.floor(Math.random() * categories.length)];
                } else {
                    const categories = ['night', 'dark', 'city', 'abstract'];
                    return categories[Math.floor(Math.random() * categories.length)];
                }
            }
            
            function fetchAndSetBackground(isInitialLoad = false) {
                if (isRefreshing && !isInitialLoad) return;
                isRefreshing = true;
                if (!isInitialLoad) {
                    refreshIcon.classList.add('is-spinning');
                }

                const category = getBackgroundCategory();
                const hour = new Date().getHours();
                
                let imageUrl;
                if (hour >= 6 && hour < 18) {
                    imageUrl = `https://source.unsplash.com/1920x1080/?${category},bright,clear&sig=${new Date().getTime()}`;
                } else {
                    imageUrl = `https://source.unsplash.com/1920x1080/?${category},dark,moody&sig=${new Date().getTime()}`;
                }
                
                const img = new Image();
                img.src = imageUrl;

                const stopRefreshing = () => {
                    if (!isInitialLoad) {
                        refreshIcon.classList.remove('is-spinning');
                    }
                    isRefreshing = false;
                };

                const applyImage = (url) => {
                     if (isInitialLoad) {
                        backgroundContainer.style.backgroundImage = `url(${url})`;
                        backgroundContainer.classList.add('loaded');
                        completeLoading(); // Transition to main content
                    } else {
                        const pseudoStyle = document.createElement('style');
                        pseudoStyle.innerHTML = `#background-container::before { background-image: url(${url}); }`;
                        pseudoStyleContainer.innerHTML = '';
                        pseudoStyleContainer.appendChild(pseudoStyle);

                        backgroundContainer.classList.add('is-fading');

                        setTimeout(() => {
                            backgroundContainer.style.backgroundImage = `url(${url})`;
                            backgroundContainer.classList.remove('is-fading');
                        }, 800);
                    }
                };

                img.onload = () => {
                    applyImage(imageUrl);
                    stopRefreshing();
                };

                img.onerror = () => {
                    console.error('Unsplash failed, trying fallback from Picsum.');
                    const fallbackUrl = `https://picsum.photos/1920/1080?random=${new Date().getTime()}`;
                    const fallbackImg = new Image();
                    fallbackImg.src = fallbackUrl;
                    
                    fallbackImg.onload = () => {
                        applyImage(fallbackUrl);
                        stopRefreshing();
                    };
                    
                    fallbackImg.onerror = () => {
                        console.error('Fallback from Picsum also failed.');
                        if (isInitialLoad) {
                             backgroundContainer.style.backgroundColor = '#333';
                             backgroundContainer.classList.add('loaded');
                             completeLoading(); // Also transition if all fallbacks fail
                        }
                        stopRefreshing();
                    };
                };
            }

            refreshButton.addEventListener('click', () => fetchAndSetBackground(false));

            // --- Time and Date ---
            function updateTime() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                timeEl.textContent = `${hours}:${minutes}`;

                const month = now.getMonth() + 1;
                const day = now.getDate();
                const weekday = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'][now.getDay()];
                dateEl.textContent = `${month}月${day}日, ${weekday}`;
            }

            // --- Hitokoto Functionality ---
            function fetchHitokoto() {
                if (isFetchingHitokoto) return;
                isFetchingHitokoto = true;

                hitokotoContainer.classList.add('is-fading');

                fetch('https://international.v1.hitokoto.cn')
                    .then(response => response.json())
                    .then(data => {
                        setTimeout(() => {
                            hitokotoContainer.textContent = data.hitokoto;
                            hitokotoContainer.classList.remove('is-fading');
                            // Allow fetching again after the animation completes
                            setTimeout(() => {
                                isFetchingHitokoto = false;
                            }, 300);
                        }, 300); // Wait for fade-out to complete
                    })
                    .catch(error => {
                        console.error('Error fetching Hitokoto:', error);
                        setTimeout(() => {
                            hitokotoContainer.textContent = '句子迷路了...';
                            hitokotoContainer.classList.remove('is-fading');
                            isFetchingHitokoto = false;
                        }, 300);
                    });
            }
            hitokotoContainer.addEventListener('click', fetchHitokoto);


            // --- Search Functionality ---
            function updateSearchEngine(engineKey) {
                if (currentEngine === engineKey && !isInitialLogoLoad) return;

                currentEngine = engineKey;
                const engine = searchEngines[engineKey];
                const newLogoHtml = `<div class="w-full h-full search-engine-icon">${engine.logo}</div>`;

                if (isInitialLogoLoad) {
                    iconContainerA.innerHTML = newLogoHtml;
                    iconContainerA.style.opacity = 1;
                    iconContainerB.style.opacity = 0;
                    activeIconContainerId = 'a';
                } else {
                    const inactiveContainer = (activeIconContainerId === 'a') ? iconContainerB : iconContainerA;
                    const activeContainer = (activeIconContainerId === 'a') ? iconContainerA : iconContainerB;
                    inactiveContainer.innerHTML = newLogoHtml;
                    activeContainer.style.opacity = 0;
                    inactiveContainer.style.opacity = 1;
                    activeIconContainerId = (activeIconContainerId === 'a') ? 'b' : 'a';
                }

                searchInput.placeholder = `在 ${engine.name} 中搜索...`;
                localStorage.setItem('searchEngine', engineKey);
            }

            function populateEngineList() {
                searchEngineList.innerHTML = '';
                engineOrder.forEach(key => {
                    const engine = searchEngines[key];
                    const item = document.createElement('div');
                    item.className = 'flex items-center p-3 cursor-pointer hover:bg-black/10 dark:hover:bg-white/20 transition-colors rounded-lg';
                    item.dataset.engine = key;
                    item.innerHTML = `
                        <div class="w-6 h-6 flex-shrink-0 flex items-center justify-center search-engine-icon text-white">${engine.logo}</div>
                        <span class="ml-4 font-medium text-white">${engine.name}</span>
                    `;
                    item.addEventListener('click', () => {
                        updateSearchEngine(key);
                        toggleEngineList(false);
                    });
                    searchEngineList.appendChild(item);
                });
            }

            function toggleEngineList(show) {
                if (show) {
                    searchEngineListWrapper.classList.remove('scale-y-0', 'opacity-0');
                } else {
                    searchEngineListWrapper.classList.add('scale-y-0', 'opacity-0');
                }
            }
            
            searchEngineLogo.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = searchEngineListWrapper.classList.contains('scale-y-0');
                toggleEngineList(isHidden);
            });

            searchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const query = searchInput.value.trim();
                if (query) {
                    const url = searchEngines[currentEngine].url + encodeURIComponent(query);
                    window.open(url, '_blank');
                    searchInput.value = '';
                }
            });

            // --- Global Click Listener to Close Menus ---
            document.addEventListener('click', (e) => {
                if (!searchEngineLogo.contains(e.target) && !searchEngineListWrapper.contains(e.target)) {
                    toggleEngineList(false);
                }
                if (!themeButton.contains(e.target) && !themeMenu.contains(e.target)) {
                    toggleThemeMenu(false);
                }
            });

            // --- Initialization ---
            function initialize() {
                // Theme
                populateThemeMenu();
                const savedTheme = localStorage.getItem('theme') || 'auto';
                applyTheme(savedTheme);

                // Background
                fetchAndSetBackground(true);
                
                // Hitokoto
                fetchHitokoto();

                // Time
                updateTime();
                setInterval(updateTime, 1000);

                // Search
                const savedEngine = localStorage.getItem('searchEngine') || 'baidu';
                populateEngineList();
                updateSearchEngine(savedEngine);
                isInitialLogoLoad = false;
            }

            initialize();
        });
    </script>
</body>
</html>